#!/bin/bash

# DTN Compliance Platform - Curl Test Collection
# Perfekt f√ºr Bewerbungsgespr√§che und Live-Demos

# Colors
GREEN='\033[0;32m'
RED='\033[0;31m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m'

# Configuration
COMPLIANCE_URL="http://localhost:8081"
GATEWAY_URL="http://localhost:8080"
TIMEOUT=10

echo -e "${PURPLE}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
echo -e "${PURPLE}‚ïë${NC}  üöÄ ${CYAN}DTN Compliance Platform${NC} - Curl Test Collection         ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}                                                                ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}  üí∞ Business Value: ${GREEN}96.960‚Ç¨ Jahresersparnis${NC}                  ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}  üéØ Zielgruppe: ${YELLOW}Deutsche Software-Dienstleister${NC}             ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}  üá©üá™ Compliance: ${GREEN}DSGVO + EU AI Act konform${NC}                  ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
echo ""

# Function to execute curl with formatting
execute_curl() {
    local name="$1"
    local method="$2"
    local url="$3"
    local data="$4"
    local icon="$5"
    
    echo -e "${BLUE}${icon} ${name}${NC}"
    echo -e "  üåê URL: ${CYAN}${url}${NC}"
    
    if [[ "$method" == "GET" ]]; then
        echo -e "  üì° Command: ${YELLOW}curl -s '${url}'${NC}"
        echo ""
        curl -s --connect-timeout $TIMEOUT "$url" | jq . 2>/dev/null || curl -s --connect-timeout $TIMEOUT "$url"
    else
        echo -e "  üì° Command: ${YELLOW}curl -s -X ${method} -H 'Content-Type: application/json' -d '${data}' '${url}'${NC}"
        echo ""
        curl -s -X "$method" -H "Content-Type: application/json" -d "$data" --connect-timeout $TIMEOUT "$url" | jq . 2>/dev/null || curl -s -X "$method" -H "Content-Type: application/json" -d "$data" --connect-timeout $TIMEOUT "$url"
    fi
    
    echo ""
    echo -e "${GREEN}‚úÖ Test completed${NC}"
    echo ""
    read -p "Dr√ºcken Sie Enter f√ºr den n√§chsten Test..."
    echo ""
}

# Health Checks
echo -e "${CYAN}üè• Health Checks & Status${NC}"
echo ""

execute_curl "Compliance Service Health Check" "GET" "$COMPLIANCE_URL/actuator/health" "" "üíö"

execute_curl "Compliance Service Status" "GET" "$COMPLIANCE_URL/api/v1/compliance/status" "" "üìä"

execute_curl "Demo Readiness Check" "GET" "$COMPLIANCE_URL/api/v1/compliance/demo-ready" "" "üéØ"

# DSGVO Art. 30 - VVT Tests
echo -e "${CYAN}üìä DSGVO Art. 30 - VVT (Verzeichnis der Verarbeitungst√§tigkeiten)${NC}"
echo ""

execute_curl "VVT Demo (Musterfirma)" "GET" "$COMPLIANCE_URL/api/v1/compliance/vvt/demo" "" "üìã"

# VVT Generation with custom data
VVT_DATA='{
  "companyName": "DTN Software GmbH",
  "industry": "Software-Dienstleistung",
  "employeeCount": 120,
  "hasCustomerData": true,
  "hasEmployeeData": true,
  "usesAIProcessing": true,
  "hasThirdCountryTransfer": false,
  "hasSpecialCategories": false,
  "dataCategories": [
    "Kundendaten",
    "Mitarbeiterdaten", 
    "Projektdaten",
    "Rechnungsdaten"
  ],
  "hasDataProtectionOfficer": true,
  "hasWorksCouncil": true,
  "demoMode": true,
  "includeBusinessMetrics": true,
  "additionalInfo": "B2B Software-Entwicklung, SCRUM-basiert, haupts√§chlich Enterprise-Kunden in DACH-Region"
}'

execute_curl "VVT Generierung (Custom)" "POST" "$COMPLIANCE_URL/api/v1/compliance/vvt/generate" "$VVT_DATA" "üìä"

# DSGVO Art. 35 - DSFA Tests
echo -e "${CYAN}üìã DSGVO Art. 35 - DSFA (Datenschutz-Folgenabsch√§tzung)${NC}"
echo ""

execute_curl "DSFA Demo (KI-System)" "GET" "$COMPLIANCE_URL/api/v1/compliance/dsfa/demo" "" "‚öñÔ∏è"

# DSFA Assessment with custom data
DSFA_DATA='{
  "processingName": "KI-basierte Kundensegmentierung",
  "processingDescription": "Automatisierte Analyse von Kundendaten zur Segmentierung f√ºr personalisierte Marketing-Kampagnen mittels Machine Learning Algorithmen",
  "dataTypes": [
    "Kundendaten",
    "Kaufverhalten", 
    "Demografische Daten",
    "Pr√§ferenzen",
    "Website-Interaktionen"
  ],
  "purposes": [
    "Marketing-Optimierung",
    "Personalisierung",
    "Kundenanalyse",
    "Umsatzsteigerung"
  ],
  "technologies": [
    "Machine Learning",
    "Datenanalyse",
    "CRM-System",
    "Analytics-Platform"
  ],
  "dataSubjects": [
    "Kunden",
    "Interessenten", 
    "Website-Besucher"
  ],
  "specialCategories": false,
  "thirdCountryTransfer": false,
  "automated_decision_making": true,
  "systematicMonitoring": false,
  "vulnerableGroups": false,
  "largeScale": true,
  "dataMatching": true,
  "innovativeTechnology": true,
  "preventsRightsExercise": false,
  "estimatedDataSubjects": 50000,
  "processingDurationMonths": 12,
  "additionalInfo": "B2B Software-Unternehmen, haupts√§chlich DACH-Region, SCRUM-basierte Entwicklung",
  "demoMode": true,
  "includeAIActAssessment": true
}'

execute_curl "DSFA Assessment (Custom)" "POST" "$COMPLIANCE_URL/api/v1/compliance/dsfa/assess" "$DSFA_DATA" "üìã"

# EU AI Act Tests
echo -e "${CYAN}ü§ñ EU AI Act - KI-Risikoklassifizierung (seit Februar 2025)${NC}"
echo ""

execute_curl "AI Risk Demo (Recommendation Engine)" "GET" "$COMPLIANCE_URL/api/v1/compliance/ai-risk/demo" "" "ü§ñ"

# AI Risk Classification with custom data
AI_RISK_DATA='{
  "systemName": "E-Commerce Recommendation Engine",
  "systemType": "Recommendation System",
  "applicationDomain": "E-Commerce",
  "systemDescription": "Machine Learning basiertes Empfehlungssystem f√ºr Produktvorschl√§ge basierend auf Nutzerverhalten, Kaufhistorie und demografischen Pr√§ferenzen",
  "dataTypes": [
    "Kaufverhalten",
    "Pr√§ferenzen",
    "Demografische Daten", 
    "Browsing-Verhalten",
    "Produktbewertungen"
  ],
  "userInteraction": true,
  "automatedDecisionMaking": true,
  "biometricData": false,
  "emotionRecognition": false,
  "criticalInfrastructure": false,
  "educationContext": false,
  "employmentContext": false,
  "essentialServices": false,
  "lawEnforcement": false,
  "migrationAsylBorder": false,
  "justiceAndDemocracy": false,
  "creditScoring": false,
  "insuranceRiskAssessment": false,
  "emergencyServices": false,
  "safetyComponents": false,
  "minorsData": false,
  "publicSpaces": false,
  "largeScale": true,
  "estimatedAffectedPersons": 50000,
  "geographicScope": "EU",
  "additionalInfo": "B2B E-Commerce Platform, haupts√§chlich DACH-Region, personalisierte Produktempfehlungen f√ºr Online-Shops",
  "demoMode": true,
  "germanStandards": true
}'

execute_curl "AI Risk Classification (Custom)" "POST" "$COMPLIANCE_URL/api/v1/compliance/ai-risk/classify" "$AI_RISK_DATA" "üéØ"

# Business Value & ROI Tests
echo -e "${CYAN}üí∞ Business Value & ROI Demonstration${NC}"
echo ""

execute_curl "Business Impact Analyse" "GET" "$COMPLIANCE_URL/api/v1/compliance/business-impact" "" "üí∞"

execute_curl "Compliance Report (Demo)" "GET" "$COMPLIANCE_URL/api/v1/compliance/report?reportType=DEMO&format=JSON" "" "üìà"

execute_curl "Compliance Report (Executive)" "GET" "$COMPLIANCE_URL/api/v1/compliance/report?reportType=EXECUTIVE&format=JSON" "" "üìä"

# Advanced Demo Tests
echo -e "${CYAN}üé™ Advanced Demo Features${NC}"
echo ""

# High-Risk DSFA Demo
DSFA_HIGH_RISK='{
  "processingName": "Biometrische Mitarbeiter√ºberwachung",
  "processingDescription": "Gesichtserkennung f√ºr Zugangskontrolle und Arbeitszeiterfassung",
  "dataTypes": ["Biometrische Daten", "Arbeitszeitdaten", "Standortdaten"],
  "purposes": ["Zugangskontrolle", "Zeiterfassung", "Sicherheits√ºberwachung"],
  "technologies": ["Gesichtserkennung", "KI-Algorithmus", "√úberwachungskameras"],
  "dataSubjects": ["Mitarbeiter", "Besucher"],
  "specialCategories": true,
  "systematicMonitoring": true,
  "automated_decision_making": true,
  "vulnerableGroups": false,
  "largeScale": true,
  "innovativeTechnology": true,
  "estimatedDataSubjects": 500,
  "processingDurationMonths": 60,
  "additionalInfo": "Hochrisiko-Verarbeitung f√ºr DSFA-Pflicht Demonstration",
  "includeAIActAssessment": true
}'

execute_curl "DSFA Hochrisiko-Demo" "POST" "$COMPLIANCE_URL/api/v1/compliance/dsfa/assess" "$DSFA_HIGH_RISK" "üö®"

# High-Risk AI System Demo
AI_HIGH_RISK='{
  "systemName": "Biometrische Mitarbeiter-√úberwachung",
  "systemType": "Biometric Identification System",
  "applicationDomain": "Human Resources",
  "systemDescription": "Gesichtserkennung f√ºr Zugangskontrolle und kontinuierliche Mitarbeiter√ºberwachung mit Emotion Detection",
  "dataTypes": ["Biometrische Daten", "Gesichtsdaten", "Emotionsdaten", "Standortdaten"],
  "userInteraction": true,
  "automatedDecisionMaking": true,
  "biometricData": true,
  "emotionRecognition": true,
  "employmentContext": true,
  "publicSpaces": true,
  "largeScale": false,
  "estimatedAffectedPersons": 500,
  "geographicScope": "NATIONAL",
  "additionalInfo": "Hochrisiko-System f√ºr EU AI Act Demo - Biometrische √úberwachung am Arbeitsplatz",
  "germanStandards": true
}'

execute_curl "AI Hochrisiko-Demo" "POST" "$COMPLIANCE_URL/api/v1/compliance/ai-risk/classify" "$AI_HIGH_RISK" "üî¥"

# Prohibited Practice Demo
AI_PROHIBITED='{
  "systemName": "Social Credit Scoring System",
  "systemType": "Social Scoring System", 
  "applicationDomain": "Public Administration",
  "systemDescription": "Bewertung von B√ºrgern basierend auf Sozialverhalten, finanzieller Situation und √∂ffentlichen Daten f√ºr Zugang zu √∂ffentlichen Dienstleistungen",
  "dataTypes": ["Sozialdaten", "Finanzdaten", "Verhaltensdaten", "√ñffentliche Daten"],
  "userInteraction": false,
  "automatedDecisionMaking": true,
  "biometricData": false,
  "emotionRecognition": false,
  "essentialServices": true,
  "justiceAndDemocracy": true,
  "largeScale": true,
  "estimatedAffectedPersons": 1000000,
  "geographicScope": "NATIONAL",
  "additionalInfo": "VERBOTEN - Social Scoring System f√ºr Demo der prohibited practices",
  "germanStandards": true
}'

execute_curl "AI Verbotene Praktiken Demo" "POST" "$COMPLIANCE_URL/api/v1/compliance/ai-risk/classify" "$AI_PROHIBITED" "‚õî"

# API Documentation Tests
echo -e "${CYAN}üìö API Documentation & Swagger${NC}"
echo ""

execute_curl "Swagger UI Check" "GET" "$COMPLIANCE_URL/swagger-ui/index.html" "" "üìö"

execute_curl "OpenAPI JSON" "GET" "$COMPLIANCE_URL/v3/api-docs" "" "üìã"

# Performance Tests
echo -e "${CYAN}‚ö° Performance Validation${NC}"
echo ""

echo -e "${BLUE}‚ö° VVT Generation Performance Test${NC}"
echo -e "  üåê URL: ${CYAN}$COMPLIANCE_URL/api/v1/compliance/vvt/demo${NC}"
echo -e "  üì° Command: ${YELLOW}time curl -s '$COMPLIANCE_URL/api/v1/compliance/vvt/demo'${NC}"
echo ""
echo "Measuring VVT generation time..."
time curl -s "$COMPLIANCE_URL/api/v1/compliance/vvt/demo" >/dev/null
echo ""
echo -e "${GREEN}‚úÖ Performance test completed${NC}"
echo ""
read -p "Dr√ºcken Sie Enter f√ºr den n√§chsten Test..."
echo ""

echo -e "${BLUE}‚ö° DSFA Assessment Performance Test${NC}"
echo -e "  üåê URL: ${CYAN}$COMPLIANCE_URL/api/v1/compliance/dsfa/demo${NC}"
echo -e "  üì° Command: ${YELLOW}time curl -s '$COMPLIANCE_URL/api/v1/compliance/dsfa/demo'${NC}"
echo ""
echo "Measuring DSFA assessment time..."
time curl -s "$COMPLIANCE_URL/api/v1/compliance/dsfa/demo" >/dev/null
echo ""
echo -e "${GREEN}‚úÖ Performance test completed${NC}"
echo ""

# Summary
echo -e "${PURPLE}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
echo -e "${PURPLE}‚ïë${NC}  üéâ ${GREEN}DTN Compliance Platform Tests Completed!${NC}               ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}                                                                ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}  üìä Business Value demonstriert:                              ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}    üí∞ ${GREEN}96.960‚Ç¨ Jahresersparnis${NC} durch Automatisierung         ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}    ‚ö° ${GREEN}95% Zeitersparnis${NC} bei VVT-Generierung                ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}    ü§ñ ${GREEN}87% Effizienzsteigerung${NC} bei DSFA-Assessment          ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}    üéØ ${GREEN}92% Automatisierung${NC} bei KI-Risikoklassifizierung      ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}                                                                ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}  üé™ Demo URLs f√ºr Bewerbungsgespr√§che:                        ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}    üìö Swagger: localhost:8081/swagger-ui/index.html           ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}    üíö Health: localhost:8081/actuator/health                  ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}    üìä Status: localhost:8081/api/v1/compliance/status         ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}                                                                ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}  üíº Bewerbungs-Ready Features:                                ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}    ‚úÖ DSGVO Art. 30 + 35 vollautomatisiert                   ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}    ‚úÖ EU AI Act Compliance seit Feb 2025                     ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}    ‚úÖ Deutsche Rechtssicherheit gew√§hrleistet                 ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïë${NC}    ‚úÖ Live-APIs f√ºr Technical Interviews                      ${PURPLE}‚ïë${NC}"
echo -e "${PURPLE}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
echo ""
echo -e "${GREEN}üöÄ DTN Compliance Platform ist perfekt f√ºr Bewerbungen vorbereitet!${NC}"
echo ""
echo -e "${BLUE}üí° N√§chste Schritte:${NC}"
echo -e "  1. üê≥ Docker Setup: ${CYAN}docker-compose up -d${NC}"
echo -e "  2. üìù Step 4: Document Service f√ºr PDF-Export"
echo -e "  3. üåê Live-Demo: Render.com Deployment"
echo -e "  4. üíº Bewerbungen mit Live-Demo starten!"